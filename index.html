<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>3D VR Walkthrough - Prototype 2</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-stereo-component@1.0.0/dist/aframe-stereo-component.min.js"></script>
  </head>
  <body>
    <a-scene>
      
      <a-assets>
        <img id="kitchen1" src="Combo1_Kitchen.jpg" crossorigin="anonymous">
        <img id="hallway1" src="Combo1_Hallway.jpg" crossorigin="anonymous">
        <img id="living1" src="Combo1_LivingRoom.jpg" crossorigin="anonymous">
        <img id="bedroom1" src="Combo1_Bedroom.jpg" crossorigin="anonymous">
        <img id="kitchen8" src="Combo8_Kitchen.jpg" crossorigin="anonymous">
        <img id="hallway8" src="Combo8_Hallway.jpg" crossorigin="anonymous">
        <img id="living8" src="Combo8_LivingRoom.jpg" crossorigin="anonymous">
      </a-assets>

      <a-entity id="rig" position="0 1.6 0">
        <a-camera look-controls>
          <a-cursor
            fuse="true"
            fuse-timeout="1500"
            raycaster="objects: .clickable">
          </a-cursor>
        </a-camera>

        <!-- Left Controller -->
        <a-entity 
          laser-controls="hand: left"
          raycaster="objects: .clickable; lineColor: red; lineOpacity: 0.5">
        </a-entity>
        
        <!-- Right Controller -->
        <a-entity 
          laser-controls="hand: right"
          raycaster="objects: .clickable; lineColor: blue; lineOpacity: 0.5">
        </a-entity>
      </a-entity>

      <!-- Single stereo panorama sphere -->
      <a-entity
        id="panorama"
        geometry="primitive: sphere; radius: 100; segmentsWidth: 64; segmentsHeight: 64"
        material="shader: flat; side: back; src: #hallway1"
        scale="-1 1 1"
        stereo="eye: both; mode: top-bottom">
      </a-entity>

      <!-- Hallway Hotspots -->
      <a-entity id="hallway-hotspots">
        <a-sphere 
          class="clickable"
          id="toKitchenButton"
          position="0.164 0.584 -5"
          radius="0.5" 
          color="blue"
          event-set__enter="_event: mouseenter; color: #00FFFF"
          event-set__leave="_event: mouseleave; color: #0000FF">
          <a-text value="Kitchen" align="center" position="0 1 0" scale="3 3 3" color="white"></a-text>
        </a-sphere>

        <a-sphere 
          class="clickable"
          id="styleButton"
          position="3 1.5 -5" 
          radius="0.5" 
          color="yellow"
          event-set__enter="_event: mouseenter; color: #FFFFFF"
          event-set__leave="_event: mouseleave; color: #FFFF00">
          <a-text value="Style" align="center" position="0 1 0" scale="3 3 3" color="black"></a-text>
        </a-sphere>
      </a-entity>

      <!-- Kitchen Hotspots -->
      <a-entity id="kitchen-hotspots" visible="false">
        <a-sphere 
          class="clickable"
          id="toHallwayFromKitchen"
          position="0 1.5 -5" 
          radius="0.5" 
          color="red"
          event-set__enter="_event: mouseenter; color: #FF00FF"
          event-set__leave="_event: mouseleave; color: #FF0000">
          <a-text value="Hallway" align="center" position="0 1 0" scale="3 3 3" color="white"></a-text>
        </a-sphere>

        <a-sphere 
          class="clickable"
          id="styleButtonKitchen"
          position="3 1.5 -5" 
          radius="0.5" 
          color="yellow"
          event-set__enter="_event: mouseenter; color: #FFFFFF"
          event-set__leave="_event: mouseleave; color: #FFFF00">
          <a-text value="Style" align="center" position="0 1 0" scale="3 3 3" color="black"></a-text>
        </a-sphere>
      </a-entity>

    </a-scene>

    <script>
      let currentStyle = '1';
      let currentRoom = 'hallway';

      function updateHotspots() {
        document.querySelector('#hallway-hotspots').setAttribute('visible', false);
        document.querySelector('#kitchen-hotspots').setAttribute('visible', false);
        
        if (currentRoom === 'hallway') {
          document.querySelector('#hallway-hotspots').setAttribute('visible', true);
        } else if (currentRoom === 'kitchen') {
          document.querySelector('#kitchen-hotspots').setAttribute('visible', true);
        }
        
        console.log("Showing hotspots for: " + currentRoom);
      }
 
      function changeView(room, style) {
        const styleToUse = style || currentStyle;
        const roomLower = room.toLowerCase();
        const imageId = `#${roomLower}${styleToUse}`;
        
        console.log("Switching to: " + imageId);
        
        // Update the material src attribute
        const panorama = document.querySelector('#panorama');
        panorama.setAttribute('material', 'src', imageId);
        
        currentRoom = roomLower;
        if (style) currentStyle = style;
        
        updateHotspots();
      }

      function toggleStyle() {
        const newStyle = currentStyle === '1' ? '8' : '1';
        console.log("Toggling from style " + currentStyle + " to " + newStyle);
        changeView(currentRoom, newStyle);
      }

      document.addEventListener('DOMContentLoaded', function() {
        const scene = document.querySelector('a-scene');
        
        scene.addEventListener('loaded', function() {
          console.log("Scene loaded!");
          
          document.querySelector('#toKitchenButton').addEventListener('click', function() {
            console.log("Going to kitchen");
            changeView('kitchen');
          });
          
          document.querySelector('#styleButton').addEventListener('click', function() {
            console.log("Style button clicked");
            toggleStyle();
          });
          
          document.querySelector('#toHallwayFromKitchen').addEventListener('click', function() {
            console.log("Back to hallway");
            changeView('hallway');
          });
          
          document.querySelector('#styleButtonKitchen').addEventListener('click', function() {
            console.log("Style button clicked");
            toggleStyle();
          });
          
          updateHotspots();
        });
      });
    </script>
  </body>
</html>