<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>3D VR Walkthrough - Prototype 2</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-stereo-component/dist/aframe-stereo-component.min.js"></script>
  </head>
  <body>
    <a-scene id="mainScene" cursor="rayOrigin: mouse">
      
      <a-assets>
        <img id="kitchen1" src="Combo1_Kitchen.jpg" crossorigin="anonymous">
        <img id="hallway1" src="Combo1_Hallway.jpg" crossorigin="anonymous">
        <img id="living1" src="Combo1_LivingRoom.jpg" crossorigin="anonymous">
        <img id="bedroom1" src="Combo1_Bedroom.jpg" crossorigin="anonymous">
        <img id="kitchen8" src="Combo8_Kitchen.jpg" crossorigin="anonymous">
        <img id="hallway8" src="Combo8_Hallway.jpg" crossorigin="anonymous">
        <img id="living8" src="Combo8_LivingRoom.jpg" crossorigin="anonymous">
      </a-assets>

      <a-entity id="rig" position="0 1.6 0">
        <a-entity id="camera" camera look-controls stereocam="eye:left;">
          <a-entity cursor="fuse: true; fuseTimeout: 1500"
                    position="0 0 -1"
                    geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                    material="color: #FFF; shader: flat"
                    raycaster="objects: .clickable">
          </a-entity>
        </a-entity>
      </a-entity>

      <!-- Stereo skyboxes -->
      <a-sky id="sky-left" 
        stereo="eye: left; split: vertical" 
        src="#hallway1">
      </a-sky>

      <a-sky id="sky-right" 
        stereo="eye: right; split: vertical" 
        src="#hallway1">
      </a-sky>

      <!-- Hallway Hotspots -->
      <a-entity id="hallway-hotspots">
        <a-sphere 
          class="clickable hotspot"
          id="toKitchenButton"
          position="0.164 0.584 -9.277"
          radius="0.2" 
          color="blue">
          <a-text value="Go to Kitchen" align="center" position="0 0.6 0" scale="2 2 2"></a-text>
        </a-sphere>

        <a-sphere 
          class="clickable hotspot"
          id="styleButton"
          position="3.707 1.5 -6.455" 
          radius="0.2" 
          color="yellow">
          <a-text value="Switch Style" align="center" position="0 0.6 0" scale="2 2 2"></a-text>
        </a-sphere>
      </a-entity>

      <!-- Kitchen Hotspots -->
      <a-entity id="kitchen-hotspots" visible="false">
        <a-sphere 
          class="clickable hotspot"
          id="toHallwayFromKitchen"
          position="0 1.5 -8" 
          radius="0.2" 
          color="red">
          <a-text value="Back to Hallway" align="center" position="0 0.6 0" scale="2 2 2"></a-text>
        </a-sphere>

        <a-sphere 
          class="clickable hotspot"
          id="styleButtonKitchen"
          position="3.707 1.5 -6.455" 
          radius="0.2" 
          color="yellow">
          <a-text value="Switch Style" align="center" position="0 0.6 0" scale="2 2 2"></a-text>
        </a-sphere>
      </a-entity>

    <script>
      let currentStyle = '1';
      let currentRoom = 'hallway';

      function updateHotspots() {
        document.querySelector('#hallway-hotspots').setAttribute('visible', false);
        document.querySelector('#kitchen-hotspots').setAttribute('visible', false);
        
        // Show hotspots for current room
        if (currentRoom === 'hallway') {
          document.querySelector('#hallway-hotspots').setAttribute('visible', true);
        } else if (currentRoom === 'kitchen') {
          document.querySelector('#kitchen-hotspots').setAttribute('visible', true);
        }
        
        console.log("Showing hotspots for: " + currentRoom);
      }
 
      function changeView(room, style) {
        const styleToUse = style || currentStyle;
        const roomLower = room.toLowerCase();
        // Build ID to match your asset format: kitchen1, hallway8, etc.
        const imageId = `#${roomLower}${styleToUse}`;
        
        console.log("Switching to: " + imageId);
        
        // Update both sky elements
        const skyLeft = document.querySelector('#sky-left');
        const skyRight = document.querySelector('#sky-right');
        
        skyLeft.setAttribute('src', imageId);
        skyRight.setAttribute('src', imageId);
        
        currentRoom = roomLower;
        if (style) currentStyle = style;
        
        // Update which hotspots are visible
        updateHotspots();
      }

      function toggleStyle() {
        const newStyle = currentStyle === '1' ? '8' : '1';
        console.log("Toggling from style " + currentStyle + " to " + newStyle);
        changeView(currentRoom, newStyle);
      }

      document.addEventListener('DOMContentLoaded', function() {
        const scene = document.querySelector('a-scene');
        
        scene.addEventListener('loaded', function() {
          console.log("Scene loaded!");
          
          // Hallway hotspots
          document.querySelector('#toKitchenButton').addEventListener('click', function() {
            console.log("Going to kitchen");
            changeView('kitchen');
          });
          
          document.querySelector('#styleButton').addEventListener('click', function() {
            console.log("Style button clicked (hallway)");
            toggleStyle();
          });
          
          // Kitchen hotspots
          document.querySelector('#toHallwayFromKitchen').addEventListener('click', function() {
            console.log("Going back to hallway from kitchen");
            changeView('hallway');
          });
          
          document.querySelector('#styleButtonKitchen').addEventListener('click', function() {
            console.log("Style button clicked (kitchen)");
            toggleStyle();
          });
          
          // Initialize hotspots for starting room
          updateHotspots();
        });
      });
    </script>
  </body>
</html>
